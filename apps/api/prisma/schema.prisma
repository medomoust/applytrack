generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  user
  admin
}

enum WorkMode {
  remote
  hybrid
  onsite
}

enum EmploymentType {
  fulltime
  contract
  intern
}

enum ApplicationStatus {
  wishlist
  applied
  interview
  offer
  rejected
  ghosted
}

enum Priority {
  low
  medium
  high
}

enum ActivityEventType {
  created
  updated
  status_changed
  archived
  restored
  note_added
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(user)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  jobApplications JobApplication[]
  activityLogs    ActivityLog[]
  refreshTokens   RefreshToken[]

  @@index([email])
  @@map("users")
}

model JobApplication {
  id               String            @id @default(uuid())
  userId           String
  company          String
  roleTitle        String
  location         String?
  workMode         WorkMode
  employmentType   EmploymentType
  status           ApplicationStatus @default(wishlist)
  priority         Priority          @default(medium)
  appliedDate      DateTime?
  nextFollowUpDate DateTime?
  salaryTarget     Float?
  link             String?
  notes            String?
  archived         Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  activityLogs ActivityLog[]

  @@index([userId])
  @@index([status])
  @@index([archived])
  @@index([updatedAt])
  @@map("job_applications")
}

model ActivityLog {
  id               String            @id @default(uuid())
  userId           String
  jobApplicationId String?
  eventType        ActivityEventType
  description      String
  metadata         Json?
  createdAt        DateTime          @default(now())

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobApplication JobApplication? @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([jobApplicationId])
  @@index([createdAt])
  @@map("activity_logs")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}
