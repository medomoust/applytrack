generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Temporarily using String instead of enums to match database
// enum UserRole {
//   applicant
//   recruiter
// }

// enum Company {
//   GOOGLE
//   APPLE
//   MICROSOFT
//   AMAZON
//   META
//   NETFLIX
//   TESLA
//   TWITTER
//   SPOTIFY
//   ADOBE
// }

// enum JobPostingStatus {
//   open
//   closed
// }

// enum WorkMode {
//   remote
//   hybrid
//   onsite
// }

// enum EmploymentType {
//   fulltime
//   contract
//   intern
// }

enum ApplicationStatus {
  wishlist
  applied
  interview
  offer
  rejected
  ghosted
}

enum Priority {
  low
  medium
  high
}

enum ActivityEventType {
  created
  updated
  status_changed
  archived
  restored
  note_added
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("applicant")
  company   String? // Only for recruiters
  resumeUrl String? // Resume file URL for applicants
  isAdmin   Boolean  @default(false) // Master admin access
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  jobApplications JobApplication[]
  jobPostings     JobPosting[]
  activityLogs    ActivityLog[]
  refreshTokens   RefreshToken[]

  @@index([email])
  @@map("users")
}

model JobPosting {
  id             String           @id @default(uuid())
  recruiterId    String
  company        String
  roleTitle      String
  location       String?
  workMode       String
  employmentType String
  description    String?
  requirements   String?
  salaryRange    String?
  status         String           @default("open")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  recruiter       User             @relation(fields: [recruiterId], references: [id], onDelete: Cascade)
  jobApplications JobApplication[]

  @@index([recruiterId])
  @@index([company])
  @@index([status])
  @@map("job_postings")
}

model JobApplication {
  id               String            @id @default(uuid())
  userId           String
  jobPostingId     String
  applicantName    String
  company          String // Denormalized from JobPosting
  roleTitle        String // Denormalized from JobPosting
  location         String?
  workMode         String
  employmentType   String
  status           String            @default("applied")
  priority         String            @default("medium")
  appliedDate      DateTime          @default(now())
  nextFollowUpDate DateTime?
  salaryTarget     Float?
  notes            String?
  archived         Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPosting   JobPosting    @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  activityLogs ActivityLog[]

  @@index([userId])
  @@index([jobPostingId])
  @@index([status])
  @@index([archived])
  @@index([updatedAt])
  @@map("job_applications")
}

model ActivityLog {
  id               String            @id @default(uuid())
  userId           String
  jobApplicationId String?
  eventType        String
  description      String
  metadata         Json?
  createdAt        DateTime          @default(now())

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobApplication JobApplication? @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([jobApplicationId])
  @@index([createdAt])
  @@map("activity_logs")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}
